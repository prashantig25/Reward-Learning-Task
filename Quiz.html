<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <script src="js/jspsych.js"></script>
    <script src="js/jspsych-survey-multi-choice.js"></script>
</head>
<script>
var timeline = [];
var quiz = {
        type: "survey-multi-choice",
        preamble: `
    <p align="justify"> 
  Please answer these questions to make sure that you understood the instructions. The red * after a question indicates that those questions are compulsory. You will be provided with feedback if you respond to questions incorrectly. </p>
    </div>`,
        questions: function () {
            return questionSample;
        },
        randomize_question_order: false,
        button_label: "Submit answers",
        on_start: function () {
            document.body.style.cursor = "auto";
            nCorrect = 0;
        },
        on_finish: function (data) {
            data.questions = questionSample; // Save questions that were asked

            // Count correct responses
            var responses = data.response;
            var i;
            for (i = 0; i < questionSample.length; i++) {
                var response = responses["Q" + i];
                var correct =
                    response ===
                    questionSample[i]["options"][questionSample[i]["correct"]];
                if (correct) {
                    nCorrect++;
                } else {
                    // Add reminders for wrong answers
                    reminder_pages.push(questionSample[i]["reminder"]);
                }
            }
            // Draw a new sample of questions
            questionSample = jsPsych.randomization.sampleWithoutReplacement(
                questions,
                nQuestions
            );
        },
    };
    reminders = {
        type: "instructions",
        show_page_number: true,
        page_label: "Reminder",
        key_forward: " ",
        pages: function () {
            return reminder_pages;
        },
        on_finish: function () {
            reminder_pages = [];
        },
        on_start: () => (document.body.style.cursor = "none"),
    };
    var correct = {
        type: 'html-keyboard-response',
        stimulus: '<p style="color:green; font-size: 30px"><strong> Congratulations!</strong> </p> <br> You responded correctly to all questions. You can now proceed to the task. Please press any key to proceed.</p>',
    }
    var if_node = {
        timeline: [correct],
        conditional_function: function(){
            // get the data from the previous trial,
            // and check which key was pressed
            if(nCorrect === 3){
                return true;
            } else {
                return false;
            }
        }
    }
 quizProcedure = {
        timeline: [
            quiz,
            {
                timeline: [reminders],
                conditional_function: function () {
                    return nCorrect < nCorrectRequired;
                },
            },
            if_node,
        ],

    };
    
</script>
</html>

// Reference: https://github.com/moltaire/causality_task/ 
